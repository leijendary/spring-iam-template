databaseChangeLog:
  - changeSet:
      id: create-account-table
      author: Leijendekker
      changes:
        - createTable:
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: row_id
                  type: bigserial
                  autoIncrement: true
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: type
                  type: varchar(8)
                  constraints:
                    nullable: false
              - column:
                  defaultValue: active
                  name: status
                  type: varchar(10)
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: timestamp with time zone
                  constraints:
                    nullable: false
                  defaultValueDate: current_timestamp
              - column:
                  name: created_by
                  type: text
                  constraints:
                    nullable: false
              - column:
                  name: deleted_at
                  type: timestamp with time zone
              - column:
                  name: deleted_by
                  type: text
            tableName: account
  - changeSet:
      id: create-role-table
      author: Leijendekker
      changes:
        - createTable:
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: row_id
                  type: bigserial
                  autoIncrement: true
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: name
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: text
              - column:
                  name: version
                  type: int
                  defaultValueNumeric: 0
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: timestamp with time zone
                  constraints:
                    nullable: false
                  defaultValueDate: current_timestamp
              - column:
                  name: created_by
                  type: text
                  constraints:
                    nullable: false
              - column:
                  name: last_modified_at
                  type: timestamp with time zone
                  constraints:
                    nullable: false
                  defaultValueDate: current_timestamp
              - column:
                  name: last_modified_by
                  type: text
                  constraints:
                    nullable: false
            tableName: role
  - changeSet:
      id: create-user-table
      author: Leijendekker
      changes:
        - createTable:
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: row_id
                  type: bigserial
                  autoIncrement: true
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: account_id
                  type: uuid
              - column:
                  name: role_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: first_name
                  type: text
              - column:
                  name: middle_name
                  type: text
              - column:
                  name: last_name
                  type: text
              - column:
                  name: email
                  type: text
              - column:
                  name: email_verified
                  type: boolean
              - column:
                  name: country_code
                  type: varchar(4)
              - column:
                  name: phone
                  type: text
              - column:
                  name: phone_verified
                  type: boolean
              - column:
                  name: image
                  type: text
              - column:
                  name: status
                  type: varchar(20)
                  defaultValue: active
                  constraints:
                    nullable: false
              - column:
                  name: version
                  type: int
                  defaultValueNumeric: 0
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: timestamp with time zone
                  constraints:
                    nullable: false
                  defaultValueDate: current_timestamp
              - column:
                  name: created_by
                  type: text
                  constraints:
                    nullable: false
              - column:
                  name: last_modified_at
                  type: timestamp with time zone
                  constraints:
                    nullable: false
                  defaultValueDate: current_timestamp
              - column:
                  name: last_modified_by
                  type: text
                  constraints:
                    nullable: false
              - column:
                  name: deleted_at
                  type: timestamp with time zone
              - column:
                  name: deleted_by
                  type: text
            tableName: user
  - changeSet:
      id: create-user-credential-table
      author: Leijendekker
      changes:
        - createTable:
            columns:
              - column:
                  name: id
                  type: bigserial
                  autoIncrement: true
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: user_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: username
                  type: text
                  constraints:
                    nullable: false
              - column:
                  name: password
                  type: char(60)
              - column:
                  name: type
                  type: varchar(12)
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: timestamp with time zone
                  constraints:
                    nullable: false
                  defaultValueDate: current_timestamp
              - column:
                  name: last_used_at
                  type: timestamp with time zone
            tableName: user_credential
  - changeSet:
      id: create-permission-table
      author: Leijendekker
      changes:
        - createTable:
            columns:
              - column:
                  name: id
                  type: bigserial
                  autoIncrement: true
                  constraints:
                    nullable: false
                    primaryKey: true
              - column:
                  name: value
                  type: text
                  constraints:
                    nullable: false
            tableName: permission
  - changeSet:
      id: create-role-permission-table
      author: Leijendekker
      changes:
        - createTable:
            columns:
              - column:
                  name: id
                  type: bigserial
                  autoIncrement: true
                  constraints:
                    nullable: false
                    primaryKey: true
              - column:
                  name: role_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: permission_id
                  type: bigint
                  constraints:
                    nullable: false
            tableName: role_permission
  - changeSet:
      id: create-verification-table
      author: Leijendekker
      changes:
        - createTable:
            columns:
              - column:
                  name: id
                  type: bigserial
                  constraints:
                    nullable: false
                    primaryKey: true
              - column:
                  name: user_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: code
                  type: varchar(36)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: expires_at
                  type: timestamp with time zone
              - column:
                  name: device_id
                  type: text
                  constraints:
                    nullable: false
              - column:
                  name: field
                  type: varchar(12)
              - column:
                  name: type
                  type: varchar(16)
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: timestamp with time zone
                  constraints:
                    nullable: false
                  defaultValueDate: current_timestamp
            tableName: verification
  - changeSet:
      id: create-auth-table
      author: Leijendekker
      changes:
        - createTable:
            columns:
              - column:
                  name: id
                  type: bigserial
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: user_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: username
                  type: text
                  constraints:
                    nullable: false
              - column:
                  name: audience
                  type: text
                  constraints:
                    nullable: false
              - column:
                  name: type
                  type: VARCHAR(12)
                  constraints:
                    nullable: false
              - column:
                  name: device_id
                  type: text
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: created_at
                  type: timestamp with time zone
                  constraints:
                    nullable: false
                  defaultValueDate: current_timestamp
            tableName: auth
  - changeSet:
      id: create-auth-access-table
      author: Leijendekker
      changes:
        - createTable:
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: auth_id
                  type: bigint
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: token
                  type: text
                  constraints:
                    nullable: false
              - column:
                  name: expires_at
                  type: timestamp with time zone
                  constraints:
                    nullable: false
            tableName: auth_access
  - changeSet:
      id: create-auth-refresh-table
      author: Leijendekker
      changes:
        - createTable:
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
                    unique: true
              - column:
                  name: auth_id
                  type: bigint
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: access_token_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: token
                  type: text
                  constraints:
                    nullable: false
              - column:
                  name: expires_at
                  type: timestamp with time zone
                  constraints:
                    nullable: false
            tableName: auth_refresh
  - changeSet:
      id: create-user-device-table
      author: Leijendekker
      changes:
        - createTable:
            columns:
              - column:
                  name: id
                  type: bigserial
                  autoIncrement: true
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: user_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: token
                  type: text
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: platform
                  type: varchar(20)
              - column:
                  name: endpoint
                  type: varchar(250)
              - column:
                  name: created_at
                  type: timestamp with time zone
                  constraints:
                    nullable: false
                  defaultValueDate: current_timestamp
            tableName: user_device
  - changeSet:
      id: create-user-account-id-foreign-key
      author: Leijendekker
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: account_id
            baseTableName: user
            constraintName: user_account_id_fkey
            deferrable: false
            initiallyDeferred: false
            onDelete: NO ACTION
            onUpdate: NO ACTION
            referencedColumnNames: id
            referencedTableName: account
            validate: true
  - changeSet:
      id: add-role-name-case-insensitive-unique-constraint
      author: Leijendekker
      changes:
        - sql:
            sql: create unique index role_name_key on role (lower(name));
  - changeSet:
      id: add-role-permission-role-id-foreign-key
      author: Leijendekker
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: role_id
            baseTableName: role_permission
            constraintName: role_permission_role_id_fkey
            deferrable: false
            initiallyDeferred: false
            onDelete: NO ACTION
            onUpdate: NO ACTION
            referencedColumnNames: id
            referencedTableName: role
            validate: true
  - changeSet:
      id: add-user-role-id-foreign-key
      author: Leijendekker
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: role_id
            baseTableName: user
            constraintName: user_role_id_fkey
            deferrable: false
            initiallyDeferred: false
            onDelete: NO ACTION
            onUpdate: NO ACTION
            referencedColumnNames: id
            referencedTableName: role
            validate: true
  - changeSet:
      id: add-user-email-case-insensitive-unique-constraint
      author: Leijendekker
      changes:
        - sql:
            sql: create unique index user_email_key
              on "user" (lower(email))
              where deleted_at is null;
  - changeSet:
      id: add-user-country-code-phone-unique-constraint
      author: Leijendekker
      changes:
        - sql:
            sql: create unique index user_country_code_phone_key
              on "user" (country_code, phone)
              where deleted_at is null;
  - changeSet:
      id: add-user-credential-user-id-foreign-key
      author: Leijendekker
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: user_id
            baseTableName: user_credential
            constraintName: user_credential_user_id_fkey
            deferrable: false
            initiallyDeferred: false
            onDelete: NO ACTION
            onUpdate: NO ACTION
            referencedColumnNames: id
            referencedTableName: user
            validate: true
  - changeSet:
      id: add-verification-user-id-foreign-key
      author: Leijendekker
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: user_id
            baseTableName: verification
            constraintName: verification_user_id_fkey
            deferrable: false
            initiallyDeferred: false
            onDelete: NO ACTION
            onUpdate: NO ACTION
            referencedColumnNames: id
            referencedTableName: user
            validate: true
  - changeSet:
      id: add-user-credential-user-id-username-type-index
      author: Leijendekker
      changes:
        - createIndex:
            columns:
              - column:
                  name: user_id
              - column:
                  name: username
              - column:
                  name: type
            indexName: user_credential_user_id_username_type_idx
            tableName: user_credential
  - changeSet:
      id: add-user-credential-user-id-username-index
      author: Leijendekker
      changes:
        - createIndex:
            columns:
              - column:
                  name: user_id
              - column:
                  name: username
            indexName: user_credential_user_id_username_idx
            tableName: user_credential
  - changeSet:
      id: add-permission-permission-case-insensitive-unique-constraint
      author: Leijendekker
      changes:
        - sql:
            sql: create unique index permission_permission_key on permission (lower(permission));
  - changeSet:
      id: add-role-permission-permission-id-foreign-key
      author: Leijendekker
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: permission_id
            baseTableName: role_permission
            constraintName: role_permission_permission_id_fkey
            deferrable: false
            initiallyDeferred: false
            onDelete: NO ACTION
            onUpdate: NO ACTION
            referencedColumnNames: id
            referencedTableName: permission
            validate: true
  - changeSet:
      id: add-role-permission-role-id-permission-id-unique-constraint
      author: Leijendekker
      changes:
        - createIndex:
            columns:
              - column:
                  name: role_id
              - column:
                  name: permission_id
            indexName: role_permission_role_id_permission_id_key
            tableName: role_permission
            unique: true
  - changeSet:
      id: add-verification-user-id-type-index
      author: Leijendekker
      changes:
        - createIndex:
            columns:
              - column:
                  name: user_id
              - column:
                  name: type
            indexName: verification_user_id_type_idx
            tableName: verification
  - changeSet:
      id: add-verification-user-id-code-field-type-index
      author: Leijendekker
      changes:
        - createIndex:
            columns:
              - column:
                  name: code
              - column:
                  name: type
            indexName: verification_code_type_idx
            tableName: verification
  - changeSet:
      id: add-user-created-at-row-id-index
      author: Leijendekker
      changes:
        - createIndex:
            columns:
              - column:
                  name: created_at
                  descending: true
              - column:
                  name: row_id
                  descending: true
            indexName: user_created_at_row_id_idx
            tableName: user
  - changeSet:
      id: add-account-created-at-row-id-index
      author: Leijendekker
      changes:
        - createIndex:
            columns:
              - column:
                  name: created_at
                  descending: true
              - column:
                  name: row_id
                  descending: true
            indexName: account_created_at_row_id_idx
            tableName: account
  - changeSet:
      id: add-role-created-at-row-id-index
      author: Leijendekker
      changes:
        - createIndex:
            columns:
              - column:
                  name: created_at
                  descending: true
              - column:
                  name: row_id
                  descending: true
            indexName: role_created_at_row_id_idx
            tableName: role
  - changeSet:
      id: add-auth-user-id-foreign-key
      author: Leijendekker
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: user_id
            baseTableName: auth
            constraintName: auth_user_id_fkey
            deferrable: false
            initiallyDeferred: false
            onDelete: NO ACTION
            onUpdate: NO ACTION
            referencedColumnNames: id
            referencedTableName: user
            validate: true
  - changeSet:
      id: add-auth-access-auth-id-foreign-key
      author: Leijendekker
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: auth_id
            baseTableName: auth_access
            constraintName: auth_access_auth_id_fkey
            deferrable: false
            initiallyDeferred: false
            onDelete: NO ACTION
            onUpdate: NO ACTION
            referencedColumnNames: id
            referencedTableName: auth
            validate: true
  - changeSet:
      id: add-auth-refresh-auth-id-foreign-key
      author: Leijendekker
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: auth_id
            baseTableName: auth_refresh
            constraintName: auth_refresh_auth_id_fkey
            deferrable: false
            initiallyDeferred: false
            onDelete: NO ACTION
            onUpdate: NO ACTION
            referencedColumnNames: id
            referencedTableName: auth
            validate: true
  - changeSet:
      id: add-user-device-user-id-foreign-key
      author: Leijendekker
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: user_id
            baseTableName: user_device
            constraintName: user_device_user_id_fkey
            deferrable: false
            initiallyDeferred: false
            onDelete: NO ACTION
            onUpdate: NO ACTION
            referencedColumnNames: id
            referencedTableName: user
            validate: true
  - changeSet:
      id: add-user-device-user-id-token-index
      author: Leijendekker
      changes:
        - createIndex:
            columns:
              - column:
                  name: user_id
              - column:
                  name: token
            indexName: user_device_user_id_token_idx
            tableName: user_device
